var y=Object.defineProperty;var M=(o,e,t)=>e in o?y(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var a=(o,e,t)=>(M(o,typeof e!="symbol"?e+"":e,t),t);import{a as S}from"./axios-1779699b.js";import{T as x}from"./TabsGrid-2aad9bf8.js";import{C as b,c as u,f as m}from"./CustomDropdownFilter-b5d48bec.js";import{g as p}from"./wasClickedOutside-18ded071.js";import{f as g}from"./colors-10675ae3.js";import{g as D}from"./getDataFromOption-f8a05e9b.js";class C extends b{constructor(e=void 0,t="names-dropdown item"){super(null,e,t),document.addEventListener("optionSelected",r=>this.onActiveOptionsChanged(r)),document.addEventListener("optionDeselected",r=>this.onActiveOptionsChanged(r))}onOptionClicked(e){let t;const r=D(e);e.className.includes("selected")?t=new Event("optionDeselected"):t=new Event("optionSelected"),t.filter=this,Object.assign(t,r),t.option=e;const s=e.getElementsByClassName("pseudo-checkbox")[0];s&&(t.checkbox=p(s.getAttribute("checkboxid"))),document.dispatchEvent(t)}onOptionSelected(e){}onOptionDeselected(e){}onActiveOptionsChanged(e){if(e.filter==this&&(this.options.forEach(t=>{var r,s;if(t.className.includes("selected")&&!this.allowMultiple){const i=t.getElementsByClassName("pseudo-checkbox")[0];i&&p(i.getAttribute("checkboxid")).checked(!1),t.className=t.className.replace(" selected",""),this.onOptionDeselected(e),this.activeOptions=0}t==e.option&&(e.type=="optionSelected"&&(t.className+=" selected",(r=e.checkbox)==null||r.checked(!0),this.onOptionSelected(e),this.activeOptions++),e.type=="optionDeselected"&&(t.className=t.className.replace(" selected",""),(s=e.checkbox)==null||s.checked(!1),this.onOptionDeselected(e),this.activeOptions>0&&this.activeOptions--))}),this.counter!=null))switch(this.counter.textContent=this.activeOptions,this.activeOptions){case 0:this.counter.style.visibility="hidden",this.title.textContent=this.defaultTitle,this.title.style.color=this.defaultTitleColor;break;case 1:this.counter.style.visibility="hidden",e.type=="optionSelected"?this.title.textContent=e.displayName:this.options.forEach(t=>{if(t.className.includes("selected")){this.title.textContent=t.textContent;return}}),this.title.style.color=g;break;default:this.counter.style.visibility="visible",this.title.textContent=this.defaultTitle,this.title.style.color=g;break}}}class h{constructor(e,t,r,s,i,n,l){a(this,"slider");a(this,"display");a(this,"maxDisplay");a(this,"data");a(this,"propertyDisplay");this.slider=document.getElementById(e),this.display=document.getElementById(t),this.maxDisplay=document.getElementById(r),this.display.step=i,this.slider.step=i,this.propertyDisplay=s,this.display.addEventListener("change",()=>{const c=this.display.value.split(" ").join(""),d=Number.parseFloat(c);this.display.value!=""?(Number.parseInt(d)<Number.parseInt(this.display.min)&&(this.display.value=this.display.min),Number.parseInt(d)>Number.parseInt(this.display.max)&&(this.display.value=this.display.max)):this.display.value=this.display.min,l!=null&&l();const f=this.display.value.split(" ").join("");this.display.value=this.addSpaces(Number.parseFloat(f)),this.syncDataFromInput(),n()}),this.display.addEventListener("input",()=>{const c=this.display.value.split(" ").join("");let d=Number.parseFloat(c);isNaN(d)&&(d=0),this.display.value=this.addSpaces(d)}),this.slider.addEventListener("input",()=>{l!=null&&l(),this.syncDataFromSlider(),n()})}addSpaces(e){let t=e.toString().split(""),r=t.length%3,s="",i=0;for(let n=0;n<t.length;n++)s+=t[n],i=r-n%3-1,(i==0||i==-3)&&(s+=" ");return s.trim()}getDisplayInfo(e=!1){return e?this.addSpaces(this.data[this.propertyDisplay]):this.data[this.propertyDisplay]}getMaxDisplayInfo(){return this.slider.max}syncDataFromInput(){this.data[this.propertyDisplay]=u(Number.parseFloat(this.display.value.split(" ").join("")),-2),this.slider.value=this.getDisplayInfo(),this.maxDisplay.textContent=this.getMaxDisplayInfo()}syncDataFromSlider(){this.data[this.propertyDisplay]=u(Number.parseFloat(this.slider.value),-2),this.display.value=this.getDisplayInfo(!0),this.maxDisplay.textContent=this.getMaxDisplayInfo()}load(e,t,r,s){this.data=e,this.slider.min=t,this.slider.max=s,this.slider.value=r,this.display.min=t,this.display.max=s,this.syncDataFromSlider(),this.maxDisplay.textContent=this.getMaxDisplayInfo()}}class E{constructor(){a(this,"baseRate",0);a(this,"startFee",0);a(this,"maxFee",0);a(this,"minSumm",0);a(this,"maxSumm",0);a(this,"minTerm",0);a(this,"maxTerm",0);a(this,"maxRate",40);a(this,"displayName","");a(this,"currentPrice",1e6);a(this,"currentFee",0);a(this,"currentYears",0);a(this,"currentRate",0)}}class P{constructor(){a(this,"allPrograms","Все программы");a(this,"currentMortgage");a(this,"priceSlider");a(this,"feeSlider");a(this,"yearsSlider");a(this,"selectedPrograms",[this.allPrograms]);a(this,"selectedBanks",[]);a(this,"tabsGrid");a(this,"banksDropdown");a(this,"cachedFeeRatio",0);a(this,"preferredPrice",0);a(this,"preferredFeeRatio",0);a(this,"preferredYear",0);a(this,"sortingParameter","min_rate");a(this,"sortingOrder","asc");a(this,"currentMortgageId",-1);a(this,"allCards",[]);this.tabsGrid=new x("mortgage-type-selection-buttons",e=>this.onTabClicked(e),!0),this.banksDropdown=new C("bank"),this.banksDropdown.onOptionSelected=e=>{this.banksDropdown.allowMultiple||(this.selectedBanks=[]),this.selectedBanks.includes(e.searchid)||this.selectedBanks.push(e.searchid),this.updateMortgageDropdowns()},this.banksDropdown.onOptionDeselected=e=>{this.selectedBanks.includes(e.searchid)&&(this.selectedBanks=this.selectedBanks.filter(t=>t!=e.searchid),this.updateMortgageDropdowns())},this.priceSlider=new h("mortgage-price-slider","current-mortgage-price","max-mortgage-price","currentPrice",1e5,()=>this.onPriceSliderInput(),()=>this.onBeforePriceUpdate()),this.priceSlider.getMaxDisplayInfo=()=>this.priceSlider.addSpaces(this.priceSlider.slider.max),this.feeSlider=new h("mortgage-start-fee-slider","current-fee","max-start-fee","currentFee",1e3,()=>this.onFeeSliderInput()),this.feeSlider.getDisplayInfo=(e=!1)=>e?this.feeSlider.addSpaces(Number.parseInt(this.currentMortgage.currentFee)):Number.parseInt(this.currentMortgage.currentFee),this.feeSlider.getMaxDisplayInfo=()=>this.getFeeRatio()+" %",this.yearsSlider=new h("mortgage-year-slider","current-mortgage-term","max-mortage-term","currentYears",1,()=>this.onYearSliderInput()),this.loadMortgageProgramDropdowns(),this.currentMortgage=new E,this.currentMortgage.startFee=20,this.currentMortgage.maxFee=30,this.currentMortgage.baseRate=3,this.currentMortgage.maxRate=9,this.currentMortgage.minTerm=1,this.currentMortgage.maxTerm=30,this.currentMortgage.minSumm=1e6,this.currentMortgage.maxSumm=1e7,typeof maxMortgageParameters<"u"&&(this.currentMortgage.minTerm=maxMortgageParameters.from_year,this.currentMortgage.minSumm=maxMortgageParameters.from_amount,this.currentMortgage.baseRate=maxMortgageParameters.min_rate,this.currentMortgage.startFee=maxMortgageParameters.min_initial_fee,this.currentMortgage.maxTerm=maxMortgageParameters.to_year,this.currentMortgage.maxSumm=maxMortgageParameters.to_amount,this.currentMortgage.maxRate=maxMortgageParameters.max_rate,this.currentMortgage.maxFee=maxMortgageParameters.max_initial_fee),this.currentMortgage.currentPrice=this.currentMortgage.minSumm,typeof planData<"u"&&(this.currentMortgage.currentPrice=Math.min(Math.max(this.currentMortgage.minSumm,planData.price),this.currentMortgage.maxSumm)),[this.priceSlider.slider,this.feeSlider.slider,this.yearsSlider.slider].forEach(e=>{e.addEventListener("mouseup",()=>{this.updateMortgageDropdowns()}),e.addEventListener("touchend",()=>{this.updateMortgageDropdowns()})}),this.loadSliders(this.currentMortgage,!0),this.loadSortingDropdown(),this.updateCreditSumm(this.currentMortgage)}loadMortgageProgramDropdowns(){const e=Array.from(document.getElementsByClassName("mortgage-programs dropdown-card primary-card"));this.allCards=[],e.forEach(t=>{let r;const s=Array.from(t.parentElement.getElementsByClassName("offer-card base-container"));this.allCards.push(...s),s.forEach(i=>{i.onclick=()=>{this.currentMortgage.currentRate=Number.parseFloat(i.getAttribute("minRate")),this.currentMortgage.currentPrice=Math.min(Math.max(this.currentMortgage.minSumm,this.priceSlider.slider.value),this.currentMortgage.maxSumm),this.currentMortgageId=i.getAttribute("mortgageId"),this.calculateCurrentMortgage(),document.getElementById("choose-mortgage-program-hint").style.display="none",this.updateCardActivityVisuals()}}),t.onclick=()=>{r&&clearTimeout(r),t.parentElement.className.includes(" open")?(t.parentElement.className=t.parentElement.className.replace(" open",""),r=setTimeout(()=>{s.forEach(i=>{i.style.display="none"}),r=void 0},350)):(t.parentElement.className+=" open",s.forEach(i=>{i.style.display="grid"}))}}),this.updateCardActivityVisuals()}updateCardActivityVisuals(){let e;this.allCards.forEach(t=>{t.getAttribute("mortgageId")==this.currentMortgageId?(t.className.includes(" active")||(t.className+=" active"),e=t):(t.className=t.className.replace(" active",""),t.parentElement.className=t.parentElement.className.replace(" active",""))}),e&&!e.parentElement.className.includes(" active")&&(e.parentElement.className+=" active")}onPriceSliderInput(){this.feeSlider.load(this.currentMortgage,this.currentMortgage.currentPrice*(this.currentMortgage.startFee/100),this.feeSlider.slider.value,this.currentMortgage.currentPrice*(this.currentMortgage.maxFee/100)),this.preferredPrice=this.priceSlider.slider.value,this.preferredFeeRatio=this.getFeeRatio(),this.calculateCurrentMortgage()}onFeeSliderInput(){this.preferredFeeRatio=this.getFeeRatio(),this.calculateCurrentMortgage()}onYearSliderInput(){this.preferredYear=this.yearsSlider.slider.value,this.calculateCurrentMortgage()}onBeforePriceUpdate(){this.cachedFeeRatio=this.currentMortgage[this.feeSlider.propertyDisplay]/this.currentMortgage[this.priceSlider.propertyDisplay]}onTabClicked(e){const t=e.getAttribute("data-name"),r=Array.from(this.tabsGrid.buttons.children);this.selectedPrograms.includes(t)?this.selectedPrograms=this.selectedPrograms.filter(s=>s!=t):(t==this.allPrograms?this.selectedPrograms=[]:this.selectedPrograms=this.selectedPrograms.filter(s=>s!=this.allPrograms),this.selectedPrograms.push(t)),this.selectedPrograms.length==0&&this.selectedPrograms.push(this.allPrograms),r.forEach(s=>{const i=s.getAttribute("data-name");this.selectedPrograms.includes(i)?s.className=this.tabsGrid.buttonClass+" "+this.tabsGrid.enableClass:s.className=this.tabsGrid.buttonClass+" "+this.tabsGrid.disableClass}),this.updateMortgageDropdowns()}loadSortingDropdown(){const e=document.getElementById("mortgages-sorting-dropdown");if(!e)return;const t=e.querySelector(".placeholder"),r=e.querySelector(".custom-dropdown.base-container"),s=Array.from(e.querySelectorAll(".names-dropdown.item")),i=r.className;if(!e)return;e.addEventListener("click",l=>{l.target!=r&&(r.className.includes("open")?r.className=i:r.className=i+" open")}),e.addEventListener("focusout",l=>{r.className=i});const n=[{parameter:"min_rate",order:"asc"},{parameter:"max_rate",order:"desc"},{parameter:"monthly_payment",order:"asc"},{parameter:"monthly_payment",order:"desc"}];s.forEach((l,c)=>{l.addEventListener("click",async()=>{t.textContent=l.textContent,this.sortingParameter=n[c].parameter,this.sortingOrder=n[c].order,this.updateMortgageDropdowns()})})}async updateMortgageDropdowns(){const e=new URLSearchParams;this.selectedPrograms.forEach(n=>{n!=this.allPrograms&&e.append("categories[]",n)}),this.selectedBanks.forEach(n=>{e.append("banks[]",n)}),this.preferredPrice>0&&e.set("preferred_price",this.preferredPrice),this.preferredFeeRatio>0&&e.set("preferred_initial_fee",this.preferredFeeRatio),this.preferredYear>=1&&e.set("preferred_year",this.preferredYear),e.set("sorting_parameter",this.sortingParameter),e.set("sorting_direction",this.sortingOrder);const t=document.querySelector(".mortgage-programs.base-container");t.style.opacity=.5,t.style.pointerEvents="none";const r=await S.get("/filtered-mortgages?"+e.toString());t.style.opacity=1,t.style.pointerEvents="all";const s=document.querySelector(".mortgage-programs.results-counter").querySelector("span");t.innerHTML="";let i=0;r.data.views.forEach(n=>{t.innerHTML+=n,i+=Number.parseInt(t.lastElementChild.getAttribute("offerscount"))}),i>0?i<maxMortgages?s.textContent=`${i} предложений из ${maxMortgages}`:s.textContent=`${i} предложений`:s.textContent="Ни одна из программ не подходит под эти условия",this.loadMortgageProgramDropdowns()}getFeeRatio(){return m(this.currentMortgage[this.feeSlider.propertyDisplay]/this.currentMortgage[this.priceSlider.propertyDisplay]*100,-1)}calculateCurrentMortgage(){this.calculateMortgage(this.currentMortgage)}loadSliders(e,t=!1){let r=e.currentPrice,s=20,i=10;e.currentPrice=r,e.currentFee=s,e.currentYears=i,t||(e.currentRate=this.currentMortgage.baseRate),this.priceSlider.load(e,e.minSumm,r,e.maxSumm),this.feeSlider.load(e,r*(e.startFee/100),s,r*(e.maxFee/100)),this.yearsSlider.load(e,e.minTerm,i,e.maxTerm),this.calculateCurrentMortgage(),this.preferredPrice=e.currentPrice,this.preferredYear=e.currentYears,this.preferredFeeRatio=this.getFeeRatio()}formatMoney(e){return new Intl.NumberFormat("ru-RU",{style:"currency",currency:"RUB",minimumFractionDigits:0}).format(e)}updateCreditSumm(e){const t=document.getElementById("mortgage-display");let r=e.currentPrice-e.currentFee;t.textContent=this.priceSlider.addSpaces(r.toString())+" ₽"}calculateMortgage(e){if(this.updateCreditSumm(this.currentMortgage),e.currentRate==0)return;const t=document.getElementById("monthly-payment"),r=document.getElementById("required-income");let s=e.currentRate/12/100,i=e.currentYears*12,n=e.currentPrice-e.currentFee,l=m(n/i+n*s,0);t.textContent=this.formatMoney(Number.parseInt(l.toString())),r.textContent=this.formatMoney(Number.parseInt((l*2).toString()))}}document.addEventListener("DOMContentLoaded",()=>{new P});
