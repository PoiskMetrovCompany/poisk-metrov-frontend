import{a as _}from"./axios-1779699b.js";import{s as T}from"./sharePageMenu-adc27c4b.js";import{s as q}from"./sleep-9eff569f.js";import{g as I,s as E,e as L}from"./cookies-2118fce7.js";import{l as H,s as U}from"./map-03f7a519.js";import{a as $,l as B}from"./loadPlanCardButtons-079e20a2.js";import{G as z}from"./gallery-53fa48c7.js";import"./chart-43d2a988.js";import"./menu-135c7b1f.js";async function M(a,e){const n=I("favoriteBuildings"),i=I("removedFavoriteBuildings");let t=[];const s=new FormData;if(s.set("code",a),s.set("type","building"),n&&(t=n.split(",")),!t.includes(a))t.push(a),e.className+=" orange",s.set("action","add");else{t=t.filter(v=>v!=a),e.className="building-cards card-button",s.set("action","remove");let r=[];i&&(r=i.split(",")),r.push(a),E("removedFavoriteBuildings",r.join(","),365)}L("cachedFavoriteBuildingsCount"),t.length>0?E("favoriteBuildings",t.join(","),365):L("favoriteBuildings");const c=await _.post("/api/switch-like",s),o=new Event("likesUpdated");o.newPlanCount=Number.parseInt(c.data.plans),o.newBuildingCount=Number.parseInt(c.data.buildings),o.newCount=Number.parseInt(c.data.total),o.code=a,o.action=s.get("action"),o.button=e;const u=document.getElementById(a);o.name=u.getAttribute("buildingname"),o.metro=u.getAttribute("metro"),o.metrominutes=u.getAttribute("metrominutes"),o.metromoveicon=u.getAttribute("metromoveicon"),document.dispatchEvent(o)}function V(a){const e=a.id,n=document.getElementById(e+"-like-button");n.onclick=async()=>{await M(e,n)}}function j(a){const e=document.getElementById("background-"+a.id),n=document.getElementById("more_"+a.id),i=document.getElementById("full-description-"+a.id);if(!e||!n||!i)return;let t=!1,s=!1;i.addEventListener("mouseover",()=>o(!0)),i.addEventListener("mouseleave",()=>u(!0)),i.addEventListener("click",c);function c(){s||(t?u():o())}function o(r=!1){(s||t)&&!r||(i.style.maxHeight="100%",e.style.maxHeight="28%",n.style.display="none",r||(s=!0,setTimeout(()=>{t=!0,s=!1},350)))}function u(r=!1){(s||!t)&&!r||(i.style.maxHeight="40%",e.style.maxHeight="55%",n.style.display="grid",r||(s=!0,setTimeout(()=>{t=!1,s=!1},350)))}}function R(a,e=!1){const n=document.getElementById("background-"+a.id),i=JSON.parse(document.getElementById("previews_"+a.id).value),t=a.getElementsByClassName("card-area-container")[0],s=new ResizeObserver(()=>u());let c={x:0,y:0},o=0;s.observe(t.parentElement),u();function u(){t.style.position="absolute";const l=window.getComputedStyle(t.parentElement),d=l.padding;t.style.width=l.width,t.style.height=l.height,t.style.transform=`translate(-${d},-${d})`}n.addEventListener("touchstart",r,!1),n.addEventListener("touchend",v,!1);function r(l){c.x=l.changedTouches[0].pageX,c.y=l.changedTouches[0].pageY}function v(l){let d={};d.x=c.x-l.changedTouches[0].pageX,d.y=c.y-l.changedTouches[0].pageY;const f=Number.parseInt(t.style.width)/3;return d.x>f&&(o++,o=Math.min(Math.max(o,0),i.length-1),g(o)),d.x<-f&&(o--,o=Math.min(Math.max(o,0),i.length-1),g(o)),d}let m=[],h=[];if(i.length>0){for(let l=0;l<i.length;l++){const d=document.getElementById("indicator_"+a.id+"_"+l);d&&m.push(d);const f=document.getElementById("area_"+a.id+"_"+l);f&&(h.push(f),e?h[l].addEventListener("click",()=>g(l)):h[l].addEventListener("mouseover",()=>g(l)))}m[0]&&(m[0].className+=" active"),!m[1]&&m[0]&&(m[0].style.display="none")}function g(l){if(i.length>1){const d=i[l];let f=0;if(f=d.x,d.size_x<n.clientWidth){const w=n.clientWidth/d.size_x;n.style.backgroundSize=`auto ${d.size_y*w}px`,f*=w,d.size_y/w/2}else{n.style.backgroundSize="";const w=(d.size_x-n.clientWidth)/2;f+=w}n.style.backgroundPositionX=`-${f}px`,b(l)}}function b(l){m.forEach(d=>d.className="slider-indicator"),m[l].className+=" active",o=l}}let N,x,A,G=!1,D=[];async function C(a="building-cards container",e=!1){const n=Array.from(document.getElementsByClassName(a));G||([N,x,A]=await H(),G=!0);for(let i=0;i<n.length;i++){const t=n[i];j(t),R(t);const s=t.getAttribute("id");if(T("share-real-estate-button-"+s,()=>window.location.host+"/"+s),V(t),x){e&&await q(10);const c=await U(t,N,x,A,()=>D.forEach(o=>o()));D.push(c)}}}function k(){Array.from(document.getElementsByClassName("expanded-plan-card container")).forEach(e=>{const n=e.querySelector(".favorites-deleted.card"),i=e.getAttribute("offerid"),t=n.querySelectorAll(".favorites-deleted.description"),s=t[0],c=t[1];let o;s.onclick=async()=>{o!=null&&await $(i,o,e)};let u;c.onclick=()=>{if(u!=null)return;let r=()=>{e.style.opacity-=.02,e.style.opacity<=0&&(clearInterval(u),e.remove(),u=void 0)};e.style.opacity=1,u=setInterval(r,1)},document.addEventListener("likesUpdated",r=>{r.code==i&&(r.action=="remove"?n.className="favorites-deleted card visible":n.className="favorites-deleted card",o=r.button)})})}function S(){Array.from(document.getElementsByClassName("expanded-building-cards container")).forEach(e=>{const n=e.querySelector(".favorites-deleted.card"),i=e.getAttribute("id"),t=n.querySelectorAll(".favorites-deleted.description"),s=t[0],c=t[1];let o;s.onclick=async()=>{o!=null&&await M(i,o)};let u;c.onclick=()=>{if(u!=null)return;let r=()=>{e.style.opacity-=.02,e.style.opacity<=0&&(clearInterval(u),e.remove(),u=void 0)};e.style.opacity=1,u=setInterval(r,1)},document.addEventListener("likesUpdated",r=>{r.code==i&&(r.action=="remove"?n.className="favorites-deleted card visible":n.className="favorites-deleted card",o=r.button)})})}let y,p;document.addEventListener("DOMContentLoaded",async()=>{const a=document.getElementById("favorites-compare-plans-button"),e=document.getElementById("favorites-compare-buildings-button");a!=null&&(a.onclick=()=>n("fullComparisonPlans")),e!=null&&(e.onclick=()=>n("fullComparisonBuildings"));const n=s=>{let c=I(s);c==null&&(c="false"),c=c!=="true",E(s,c.toString(),365),E("lastFavoriteSelected",s,365),window.location.reload()};B("expanded-plan-card container"),B(),await C("expanded-building-cards container"),await C(),O(),k(),P(),S();const i=[{dropdown:"favorites-sorting-plans-dropdown",gallery:"plans-gallery",url:"/api/favorite-plan-views",cardClass:"expanded-plan-card container",onViewsLoaded:()=>{B("expanded-plan-card container"),O(),k()}},{dropdown:"favorites-sorting-buildings-dropdown",gallery:"complexes-gallery",url:"/api/favorite-building-views",cardClass:"expanded-building-cards container",onViewsLoaded:async()=>{await C("expanded-building-cards container"),P(),S()}}],t=[{dropdown:"favorites-sorting-plans-dropdown",gallery:"plans-gallery-compact",url:"/api/favorite-plan-views",cardClass:"plan-card container",onViewsLoaded:()=>{B(),k()}},{dropdown:"favorites-sorting-buildings-dropdown",gallery:"complexes-gallery-compact",url:"/api/favorite-building-views",cardClass:"building-cards container",onViewsLoaded:async()=>{await C(),S()}}];i.forEach(s=>F(s)),t.forEach(s=>F(s))});function F(a){const e=document.getElementById(a.dropdown),n=document.getElementById(a.gallery);if(!e||!n)return;const i=e.querySelector(".placeholder"),t=e.querySelector(".custom-dropdown.base-container"),s=e.querySelector(".icon.arrow-tailless"),c=Array.from(e.querySelectorAll(".names-dropdown.item")),o=t.className;if(!e)return;e.addEventListener("click",r=>{r.target!=t&&(t.className.includes("open")?(t.className=o,s.style.rotate="0deg"):(t.className=o+" open",s.style.rotate="180deg"))}),e.addEventListener("focusout",r=>{t.className=o});const u=[{parameter:"price",order:"asc"},{parameter:"price",order:"desc"},{parameter:"area",order:"asc"},{parameter:"area",order:"desc"}];c.forEach((r,v)=>{r.addEventListener("click",async()=>{var b;i.textContent=r.textContent,n.style.opacity=.5;const m=new URLSearchParams(u[v]),g=(b=(await _.get(`${a.url}?${m.toString()}`)).data)==null?void 0:b.views;if(n.style.opacity=1,g){const l=Array.from(n.getElementsByClassName(a.cardClass));for(let d=0;d<l.length;d++)l[d].remove();g.forEach(d=>{n.innerHTML+=d})}await a.onViewsLoaded()})})}function O(){var n;y&&(y=void 0);const a="plans-gallery",e="plans-gallery-buttons";y=new z(a,e),y.isScrollOnClick=!1,y.isButtonIcon=!0,y.noDisable=!0,(n=document.getElementById(a))==null||n.scrollTo(0,0)}function P(){var n,i,t;p&&(p=void 0);const a="complexes-gallery",e="complexes-gallery-buttons";p=new z(a,e,()=>{},"orange",!0),p.isScrollOnClick=!1,p.isButtonIcon=!0,p.noDisable=!0,(n=p.buttonBack)==null||n.setAttribute("enabled",!0),(i=p.buttonForward)==null||i.setAttribute("enabled",!0),(t=document.getElementById(a))==null||t.scrollTo(0,0)}
