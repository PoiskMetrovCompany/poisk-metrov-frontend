var p=Object.defineProperty;var y=(l,t,e)=>t in l?p(l,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[t]=e;var m=(l,t,e)=>(y(l,typeof t!="symbol"?t+"":t,e),e);import{v as g}from"./name-7cec568d.js";function v(l,t){let e=[];["input","select"].forEach(r=>e.push(...Array.from(l.getElementsByTagName(r))));let s={};return e.forEach(r=>{t.includes(r.id)&&s[r.id]===void 0&&(s[r.id]=r.value)}),s}function E(l){Array.from(l.getElementsByTagName("input")).forEach(e=>{e.type!="submit"&&(e.value="")})}let h=!0;async function N(l,t,e,n){if(h)h=!1;else return;const s=JSON.stringify(t),o={method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:s},i=document.getElementById("loader-overlay");i&&(i.style.display="block");const a=await(await fetch(l,o)).json();i&&(i.style.display="none"),a.message=="success"?e():n(),h=!0}document.addEventListener("DOMContentLoaded",()=>{Array.from(document.getElementsByTagName("input")).filter(t=>t.parentElement.parentElement.parentElement.tagName.toLowerCase()!="phone-input").forEach(t=>{var e;if(((e=t.attributes.getNamedItem("type"))==null?void 0:e.value)=="tel"){const n=t.parentElement.querySelector(".icon"),s=t.parentElement.parentElement.parentElement;t.addEventListener("focus",r=>{r.target.value===""&&(r.target.value="+7 (")}),n==null||n.addEventListener("click",()=>{t.value="",setTimeout(()=>{t.focus()},10)}),t.addEventListener("input",r=>{let o=r.target.value.replace(/\D/g,"").match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/),i=o[1],c=o[2],a=o[3],f=o[4],u=o[5],d="";r.target.value.length<2&&(r.target.value="+7"),i!=""&&(d+="+"+i),c!=""&&(d+=" ("+c,c.length>=3&&(d+=") ")),a!=""&&(d+=a,a.length>=3&&(d+="-")),f!=""&&(d+=f,f.length>=2&&(d+="-")),u!=""&&(d+=u),r.inputType!="deleteContentBackward"&&r.inputType!="deleteContentForward"&&(r.target.value=d)}),n==null||n.addEventListener("mousedown",()=>{const r=new Event("focusin");s.dispatchEvent(r),t.value="",setTimeout(()=>{t.focus()},10)})}})});function S(l){let t=Array.from(l.querySelectorAll("#phone")),e=!0;return t.forEach(n=>{const s=n.parentElement.parentElement,r=s.parentElement.querySelector(".input-error"),o=n.parentElement.querySelector(".error-icon");n.value.length<18?(s.className="input-fieldset highlighted",r.style.display="grid",o.style.display="grid",n.className="input-text error",e=e&&!1):(s.className="input-fieldset",r.style.display="none",o.style.display="none",n.className="input-text",e=e&&!0)}),e}function b(l){let t=Array.from(l.querySelectorAll(".input-text")),e=!0;return t.forEach(n=>{var s,r;if(((s=n.attributes.getNamedItem("type"))==null?void 0:s.value)=="text"&&((r=n.attributes.getNamedItem("last_name"))==null?void 0:r.value)!="phone"){let o=!/\d/.test(n.value)||n.value.length==0;const i=n.parentElement.parentElement,c=i.parentElement.querySelector(".input-error"),a=n.parentElement.querySelector(".error-icon");a&&c&&(o?(i.className="input-fieldset",c.style.display="none",a.style.display="none",n.className="input-text"):(i.className="input-fieldset highlighted",c.style.display="grid",a.style.display="grid",n.className="input-text error")),e=e&&o}}),e}document.addEventListener("DOMContentLoaded",()=>{Array.from(document.getElementsByTagName("input")).forEach(t=>{const e=t.attributes.getNamedItem("type");if(e&&((e==null?void 0:e.value)=="text"&&(e==null?void 0:e.value)!="phone"||(e==null?void 0:e.value)=="email")){const n=t.parentElement.querySelector(".icon.action-close");n&&n.addEventListener("mousedown",()=>{t.value="",setTimeout(()=>{t.focus()},10)})}})});function q(l){let t=Array.from(l.querySelectorAll(".input-text")),e=!0;return t.forEach(n=>{var s,r;if(((s=n.attributes.getNamedItem("type"))==null?void 0:s.value)=="text"&&((r=n.attributes.getNamedItem("middle_name"))==null?void 0:r.value)!="phone"){let o=!/\d/.test(n.value)||n.value.length==0;const i=n.parentElement.parentElement,c=i.parentElement.querySelector(".input-error"),a=n.parentElement.querySelector(".error-icon");a&&c&&(o?(i.className="input-fieldset",c.style.display="none",a.style.display="none",n.className="input-text"):(i.className="input-fieldset highlighted",c.style.display="grid",a.style.display="grid",n.className="input-text error")),e=e&&o}}),e}document.addEventListener("DOMContentLoaded",()=>{Array.from(document.getElementsByTagName("input")).forEach(t=>{const e=t.attributes.getNamedItem("type");if(e&&((e==null?void 0:e.value)=="text"&&(e==null?void 0:e.value)!="phone"||(e==null?void 0:e.value)=="email")){const n=t.parentElement.querySelector(".icon.action-close");n&&n.addEventListener("mousedown",()=>{t.value="",setTimeout(()=>{t.focus()},10)})}})});class B{constructor(t,e,n,s,r,o,i){m(this,"currentButton",null);m(this,"preferredContact",null);m(this,"url",null);m(this,"requiredFields",[]);m(this,"form");m(this,"getComment");m(this,"onSuccess");m(this,"onFailure");if(this.form=document.getElementById(t),this.form==null||(this.url=n,this.requiredFields=s,this.getComment=r,this.onSuccess=o,this.onFailure=i,this.form.addEventListener("submit",a=>this.onSubmit(a)),e==null))return;const c=document.getElementById(e);if(c!=null){const a=Array.from(c.children),f=localStorage.getItem("chosen-contact");a.forEach(u=>{u.addEventListener("click",()=>this.setActive(u)),(this.currentButton==null&&f==null||f==u.dataset.name)&&this.setActive(u)}),localStorage.removeItem("chosen-contact")}}async onSubmit(t){t.preventDefault(),console.log(this.form),console.log(this.requiredFields);let e=v(this.form,this.requiredFields),n=g(this.form),s=b(this.form),r=q(this.form),o=S(this.form);if(!(n&&s&&r&&o))return;let i;this.preferredContact!=null&&this.currentButton!=null&&(i=this.currentButton.dataset.name);let c=this.getComment(i),a=e;a.name?(a.name=`САЙТ! ${a.name} ${a.last_name} ${a.middle_name}`,console.log(a)):a.name="САЙТ!",a.comment=c,this.preferredContact!=null&&(a.contact=this.preferredContact),a.city=currentCityCached;let f=this.onSuccess!=null?this.onSuccess:function(){console.log("Form sent")},u=this.onFailure!=null?this.onFailure:function(){console.log("Failed to send form")};await N(this.url,a,f,u),h&&E(this.form)}setButtonIcon(t,e,n){const s=t.querySelector(".icon");s.className=s.className.replace(e,n)}setActive(t){this.currentButton!=null&&(this.currentButton.className="tab disabled",this.setButtonIcon(this.currentButton,"enabled","disabled")),this.currentButton=t,this.currentButton.className="tab enabled",this.setButtonIcon(this.currentButton,"disabled","enabled");const e=t.querySelector(".icon").className.split(" ")[1];switch(e){case"whatsapp":case"telegram":this.preferredContact=e;break;default:this.preferredContact=null;break}}}export{B as C};
