var u=Object.defineProperty;var m=(a,t,e)=>t in a?u(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var i=(a,t,e)=>(m(a,typeof t!="symbol"?t+"":t,e),e);import{r as p}from"./CustomDropdownFilter-b5d48bec.js";import{g as h}from"./getDataFromOption-f8a05e9b.js";import{g as l}from"./wasClickedOutside-18ded071.js";function f(a){return a==a.parentElement.firstElementChild}let d=[];class C{constructor(t){i(this,"button");i(this,"context");i(this,"className");this.button=t,this.context=t.getAttribute("context"),d.push(this.context),this.className=t.className;const e=this.button.getElementsByClassName("filter counter")[0];let s=0;document.addEventListener("searchItemAdded",n=>{n.context&&(n.context==this.context||this.context=="Все"&&d.includes(n.context))&&(s++,e.style.display=s>0?"grid":"none",e.textContent=s)}),document.addEventListener("searchItemRemoved",n=>{n.context&&(n.context==this.context||this.context=="Все"&&d.includes(n.context))&&(s--,e.style.display=s>0?"grid":"none",e.textContent=s)}),this.button.addEventListener("click",()=>this.onClick()),document.addEventListener("nameCategorySwitched",n=>this.onNameCategorySwitched(n)),f(this.button)&&(this.button.className+=" selected")}onNameCategorySwitched(t){t.context!=this.context?this.button.className=this.className:this.button.className=this.className+" selected"}onClick(){const t=new Event("nameCategorySwitched");t.context=this.context,document.dispatchEvent(t)}}function y(a){const t=a.className,e=a.parentElement.getElementsByClassName(t);return a==e[0]}class I{constructor(t,e){i(this,"context");i(this,"element");i(this,"searchController");i(this,"options",[]);i(this,"defaultItemStyle");this.element=t,this.searchController=e,this.context=this.element.getAttribute("context"),document.addEventListener("nameCategorySwitched",s=>this.onNameCategorySwitched(s)),y(this.element)&&this.show(),this.options=Array.from(this.element.getElementsByClassName("names-dropdown item")),this.options.forEach(s=>this.loadItem(s)),this.options.length>0&&(this.defaultItemStyle=this.options[0].style.display),document.addEventListener("parameterLoadedFromSearch",s=>this.onParameterLoadedFromSearch(s))}onParameterLoadedFromSearch(t){this.options.forEach(e=>{const s=h(e);s.condition==t.condition&&s.value==t.value&&s.field==t.field&&this.searchController.addItem(s)})}loadItem(t){const e=t.className,s=t.getAttribute("searchid");t.addEventListener("click",()=>this.onOptionClicked(t)),document.addEventListener("searchItemAdded",n=>{n.searchid==s&&(t.className+=" selected")}),document.addEventListener("searchItemRemoved",n=>{n.searchid==s&&(t.className=e)})}onOptionClicked(t){const e=h(t);this.searchController.addOrRemoveItemWithId(e)}onNameCategorySwitched(t){t.context!=this.context?this.hide():this.show()}hide(){this.element.style.display="none"}show(){this.element.style.display="grid"}filterResults(t){this.options.forEach(e=>{const s=e.getAttribute("displayname").toLowerCase();e.style.display=s.includes(t)?this.defaultItemStyle:"none"})}}class g{constructor(t,e){i(this,"allItems",[]);i(this,"allItemIds",[]);i(this,"allItemData",[]);i(this,"currentOptions",[]);i(this,"currentOptionIds",[]);i(this,"outerCounter");i(this,"innerCounter");i(this,"searchController");i(this,"defaultItemStyle");i(this,"defaultDropdownClass");i(this,"dropdown");this.searchController=e,this.dropdown=t,this.defaultDropdownClass=t.className;const s=document.getElementById(`${t.querySelector(".custom-dropdown.base-container").id}-reset`),n=document.getElementById(`${t.querySelector(".custom-dropdown.base-container").id}-back`),c=t.querySelector("input"),o=t.querySelector(".filter.apply").querySelector(".common-button");this.outerCounter=t.querySelector(".filter.counter"),this.innerCounter=c.parentElement.querySelector(".filter.counter"),this.allItems=Array.from(t.getElementsByClassName("item")),this.allItems.forEach(r=>this.loadItem(r)),this.allItems.length>0&&(this.defaultItemStyle=this.allItems[0].style.display),t.addEventListener("click",r=>{(r.target==t||(r.target.parentElement==t||r.target.parentElement.className=="text-with-icon")&&!r.target.className.includes("base-container"))&&(t.className.includes("selected")?this.close():t.className+=" selected"),r.stopPropagation()}),o.onclick=()=>this.onApply(),document.addEventListener("searchItemAdded",r=>this.onSearchItemAdded(r)),document.addEventListener("searchItemRemoved",r=>this.onSearchItemRemoved(r)),s.onclick=()=>this.dropAppliesForDropdown(),n.onclick=()=>this.close(),c.addEventListener("input",r=>this.onInputTextChanged(r))}close(){this.dropdown.className=this.defaultDropdownClass}dropAppliesForDropdown(){this.allItemData.forEach(t=>{this.searchController.removeItemWithId(t.searchid)}),this.allItems.forEach(t=>{this.removeItemSelection(t)}),this.currentOptionIds=[],this.currentOptions=[]}loadItem(t){const e=t.className,s=h(t);this.allItemData.push(s);const n=s.searchid;this.allItemIds.push(n),t.addEventListener("click",()=>this.onItemClicked(t)),document.addEventListener("searchItemAdded",c=>{c.searchid==n&&(t.className+=" selected")}),document.addEventListener("searchItemRemoved",c=>{c.searchid==n&&(t.className=e)})}onInputTextChanged(t){const e=t.target.value.toLowerCase();this.allItems.forEach(s=>s.style.display=s.textContent.toLowerCase().includes(e)?this.defaultItemStyle:"none")}removeItemSelection(t){const e=h(t),s=t.getElementsByClassName("pseudo-checkbox")[0];let n=null;s&&(n=l(s.getAttribute("checkboxid"))),this.currentOptionIds.includes(e.searchid)&&(this.currentOptionIds=this.currentOptionIds.filter(c=>c!=e.searchid),this.currentOptions=this.currentOptions.filter(c=>c.searchid!=e.searchid),n&&n.checked(!1)),this.updateCounters()}addItemSelection(t){const e=h(t),s=t.getElementsByClassName("pseudo-checkbox")[0];let n=null;s&&(n=l(s.getAttribute("checkboxid"))),this.currentOptionIds.includes(e.searchid)||(this.currentOptionIds.push(e.searchid),this.currentOptions.push(e),n&&n.checked(!0)),this.updateCounters()}onItemClicked(t){const e=h(t);this.currentOptionIds.includes(e.searchid)?this.removeItemSelection(t):this.addItemSelection(t)}onApply(){this.allItemData.forEach(t=>{this.currentOptionIds.includes(t.searchid)||this.searchController.removeItemWithId(t.searchid)}),this.searchController.addItemGroup(this.currentOptions),this.close()}onSearchItemAdded(t){this.allItems.forEach(e=>{t.searchid==e.getAttribute("searchid")&&this.addItemSelection(e)}),this.updateCounters()}onSearchItemRemoved(t){this.allItems.forEach(e=>{t.searchid==e.getAttribute("searchid")&&this.removeItemSelection(e)}),this.updateCounters()}updateCounters(){this.updateCounter(this.outerCounter,this.currentOptions.length),this.updateCounter(this.innerCounter,this.currentOptions.length)}updateCounter(t,e){t&&(t.textContent=e,t.style.visibility=e>0?"visible":"hidden")}filterResults(t){this.allItems.forEach(e=>{const s=e.getAttribute("displayname").toLowerCase();e.style.display=s.includes(t)?this.defaultItemStyle:"none"})}}class v{constructor(t,e="search-bar"){i(this,"input");i(this,"searchController");i(this,"searchBar");i(this,"textSearch");i(this,"namesDropdown");i(this,"counter");i(this,"activeOptions",0);i(this,"inputContainerClass");i(this,"defaultNamesDropdownClass");i(this,"dropdownParentsDisplay");i(this,"dropdownButtons",[]);i(this,"nameFilters",[]);i(this,"namedListsWithApplication",[]);i(this,"allowedContexts",[]);i(this,"forms",[]);this.searchBar=document.getElementById(e),this.textSearch=this.searchBar.querySelector(".text-search"),this.input=this.textSearch.querySelector("input"),this.counter=this.textSearch.querySelector(".filter.counter"),this.searchController=t,this.namesDropdown=document.getElementById("names-filter-dropdown"),this.inputContainerClass=this.textSearch.className,this.defaultNamesDropdownClass=this.namesDropdown.className,this.forms=this.textSearch.parentElement.getElementsByTagName("form"),this.forms.length>0&&(this.dropdownParentsDisplay=this.forms[0].style.display),this.textSearch.addEventListener("focusin",o=>this.onInputFocus(o)),this.textSearch.addEventListener("focusout",o=>this.onInputBlur(o));const s=Array.from(this.searchBar.getElementsByClassName("names-dropdown button")),n=Array.from(this.searchBar.getElementsByClassName("names-dropdown container")),c=Array.from(this.searchBar.getElementsByClassName("filter base-container type-specific"));s.forEach(o=>this.dropdownButtons.push(new C(o))),n.forEach(o=>this.nameFilters.push(new I(o,t))),c.forEach(o=>this.namedListsWithApplication.push(new g(o,t))),this.allowedContexts=this.dropdownButtons.map(o=>o.context),document.addEventListener("searchItemAdded",o=>this.onSearchItemAdded(o)),document.addEventListener("searchItemRemoved",o=>this.onSearchItemRemoved(o)),document.addEventListener("nameCategorySwitched",o=>this.onNameCategorySwitched(o)),this.loadInput(),this.loadResetButton(),this.loadCloseButton(),this.filterResults()}onNameCategorySwitched(t){t.context!="Все"&&(this.input.value="",this.filterResults())}onInputFocus(t){this.open()}onInputBlur(t){!this.textSearch.contains(t.relatedTarget)&&this.close()}open(){this.textSearch.className=this.inputContainerClass+" selected",this.forms.length>0&&(this.forms[0].style.display="none"),this.input.focus(),this.namesDropdown.className=this.defaultNamesDropdownClass+" open",p.forEach(t=>t.close())}close(){this.textSearch.className=this.inputContainerClass,this.forms.length>0&&(this.forms[0].style.display=this.dropdownParentsDisplay),this.namesDropdown.className=this.defaultNamesDropdownClass,this.textSearch.blur()}loadInput(){this.input.addEventListener("keyup",({key:t})=>{t==="Enter"&&this.searchController.submitSearch()}),this.input.addEventListener("input",()=>this.filterResults())}loadResetButton(){const t=document.getElementById("reset-filters-button");t.onclick=()=>this.searchController.clearAll()}loadCloseButton(){Array.from(this.searchBar.getElementsByClassName("names-dropdown close-button"))[0].addEventListener("click",()=>this.close())}updateCounter(t,e){t&&(t.textContent=e,t.style.visibility=e>0?"visible":"hidden")}onSearchItemAdded(t){this.allowedContexts.includes(t.context)&&(this.activeOptions++,this.onActiveOptionsChanged(t))}onSearchItemRemoved(t){this.allowedContexts.includes(t.context)&&(this.activeOptions--,this.onActiveOptionsChanged(t))}onActiveOptionsChanged(t){this.counter!=null&&this.updateCounter(this.counter,this.activeOptions)}filterResults(){const t=this.input.value.toLowerCase();this.nameFilters.forEach(e=>e.filterResults(t)),this.namedListsWithApplication.forEach(e=>e.filterResults(t))}}export{v as S};
