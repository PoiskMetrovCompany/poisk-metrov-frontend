var p=Object.defineProperty;var v=(l,i,e)=>i in l?p(l,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):l[i]=e;var r=(l,i,e)=>(v(l,typeof i!="symbol"?i+"":i,e),e);import{a as f,C as b}from"./CustomDropdownFilter-b5d48bec.js";import{g as m}from"./getDataFromOption-f8a05e9b.js";function I(l,i,e,t,s,a){l.setAttribute("min-range",e),l.setAttribute("max-range",t),n(i,e,t,a),window.addEventListener("range-changed",h=>{const o=h.detail;o.sliderId==l.id&&(n(i,o.minRangeValue,o.maxRangeValue,a),s(l,o.minRangeValue,o.maxRangeValue))});function n(h,o,c,d){typeof d=="function"?u(h,d(o),d(c)):u(h,o,c)}}function u(l,i,e){const t=l.querySelectorAll(".number")[0],s=l.querySelectorAll(".number")[1];t!==void 0&&(t.textContent=i),s!==void 0&&(s.textContent=e)}class g{constructor(i,e,t=[0,0]){r(this,"rangeParent");r(this,"range",null);r(this,"rangeDisplay",null);r(this,"startMinValue",null);r(this,"startMaxValue",null);r(this,"currentMinValue",0);r(this,"currentMaxValue",0);r(this,"tiedDropdown");r(this,"lastKnob");r(this,"minKnob");r(this,"maxKnob");this.tiedDropdown=e,this.rangeParent=document.getElementById(i),this.range=document.getElementById(i+"-selector"),this.rangeDisplay=this.rangeParent.querySelector(".number-input-flex"),this.startMinValue=Number.parseFloat(this.range.getAttribute("min-range")),this.startMaxValue=Number.parseFloat(this.range.getAttribute("max-range")),this.range.getAttribute("disabled")!="1"&&(t[0]==0?this.currentMinValue=this.startMinValue:this.currentMinValue=t[0],t[1]==0?this.currentMaxValue=this.startMaxValue:this.currentMaxValue=t[1],this.loadRange(),document.addEventListener("searchItemsCleared",()=>this.resetSlider()),document.addEventListener("parameterLoadedFromSearch",a=>this.onParameterLoadedFromSearch(a)))}loadRange(){I(this.range,this.rangeDisplay,this.startMinValue,this.startMaxValue,(t,s,a)=>this.onRangeFilterUpdated(t,s,a),t=>this.formatValueForFilter(t)),this.range.setAttribute("preset-min",this.currentMinValue),this.range.setAttribute("preset-max",this.currentMaxValue);const i=["click","touch","mousedown","change","input"];this.minKnob=this.range.shadowRoot.getElementById("min"),this.maxKnob=this.range.shadowRoot.getElementById("max"),i.forEach(t=>{this.minKnob.addEventListener(t,()=>this.lastKnob=this.minKnob),this.maxKnob.addEventListener(t,()=>this.lastKnob=this.maxKnob)}),["input","change"].forEach(t=>{this.minKnob.addEventListener(t,s=>{u(this.rangeDisplay,this.formatValueForFilter(this.minKnob.value),this.formatValueForFilter(this.maxKnob.value))}),this.maxKnob.addEventListener(t,s=>{u(this.rangeDisplay,this.formatValueForFilter(this.minKnob.value),this.formatValueForFilter(this.maxKnob.value))})}),this.updateRangeDisplay()}onParameterLoadedFromSearch(i){this.tiedDropdown.fromSearchId==i.parameter&&(this.currentMinValue=i.value,this.lastKnob=this.minKnob,this.onRangeFilterUpdated(this,this.currentMinValue,this.currentMaxValue),this.loadRange()),this.tiedDropdown.toSearchId==i.parameter&&(this.currentMaxValue=i.value,this.lastKnob=this.maxKnob,this.onRangeFilterUpdated(this,this.currentMinValue,this.currentMaxValue),this.loadRange())}resetValue(i){this.tiedDropdown.fromSearchId==i.searchid&&(this.currentMinValue=this.startMinValue,this.minKnob.value=this.currentMinValue,this.loadRange()),this.tiedDropdown.toSearchId==i.searchid&&(this.currentMaxValue=this.startMaxValue,this.maxKnob.value=this.currentMaxValue,this.loadRange())}resetSlider(){this.currentMinValue=this.startMinValue,this.currentMaxValue=this.startMaxValue,document.dispatchEvent(new CustomEvent("range-reset",{bubbles:!0,composed:!0,detail:{sliderId:this.range.id}})),this.loadRange()}updateRangeDisplay(){u(this.rangeDisplay,this.formatValueForFilter(this.currentMinValue),this.formatValueForFilter(this.currentMaxValue))}formatValueForFilter(i){return i}onRangeFilterUpdated(i,e,t){this.currentMinValue=e,this.currentMaxValue=t;const s=new Event("rangeUpdated");if(s.min=e,s.max=t,s.id=this.range.id,this.lastKnob==this.minKnob){const a=new Event("input");Object.defineProperty(a,"target",{writable:!1,value:this.tiedDropdown.inputFrom}),a.target.value=e,this.tiedDropdown.inputFrom.dispatchEvent(a)}if(this.lastKnob==this.maxKnob){const a=new Event("input");Object.defineProperty(a,"target",{writable:!1,value:this.tiedDropdown.inputTo}),a.target.value=t,this.tiedDropdown.inputTo.dispatchEvent(a)}document.dispatchEvent(s)}}class V extends g{formatValueForFilter(i){return f(i/1e6,0)}onRangeFilterUpdated(i,e,t){this.currentMinValue=e,this.currentMaxValue=t;const s=new Event("rangeUpdated");if(s.min=e/1e6,s.max=t/1e6,s.id=this.range.id,this.lastKnob==this.minKnob){const a=new Event("input");Object.defineProperty(a,"target",{writable:!1,value:this.tiedDropdown.inputFrom}),a.target.value=e/1e6,this.tiedDropdown.inputFrom.dispatchEvent(a)}if(this.lastKnob==this.maxKnob){const a=new Event("input");Object.defineProperty(a,"target",{writable:!1,value:this.tiedDropdown.inputTo}),a.target.value=t/1e6,this.tiedDropdown.inputTo.dispatchEvent(a)}document.dispatchEvent(s)}}class C{constructor(){r(this,"searchItems",[]);document.searchController=this}loadParametersFromSearchBar(){const i=new URLSearchParams(window.location.search),e=[];for(let[s,a]of i.entries()){const n=a.split(",");s.includes("[")&&(s=s.split("[")[0]),n.forEach(h=>{let o="=",c=s;h=decodeURIComponent(h),s.endsWith("-from")&&(o=">=",c=c.replace("-from","")),s.endsWith("-to")&&(o="<=",c=c.replace("-to",""));const d={};d.field=c,d.condition=o,d.value=h,d.parameter=s,e.push(d)})}e.forEach(s=>{const a=new Event("parameterLoadedFromSearch");Object.assign(a,s),document.dispatchEvent(a)});const t=new Event("allParametersLoadedFromSearch");t.parameters=e,document.dispatchEvent(t)}addOrRemoveItemWithId(i){const{searchid:e}=i,t=this.searchItems.findIndex(s=>s.searchid==e);t!=-1?this.removeItem(this.searchItems[t]):this.addItem(i)}removeItemWithId(i){const e=this.searchItems.findIndex(t=>t.searchid==i);e!=-1&&this.removeItem(this.searchItems[e])}addItem(i){if(this.getItemWithId(i.searchid))return;this.searchItems.push(i),i.checkbox&&i.checkbox.checked(!0);const e=new Event("searchItemAdded");Object.assign(e,i),document.dispatchEvent(e)}addItemGroup(i){let e=[];i.forEach(t=>{this.getItemWithId(t.searchid)||(e.push(t),this.searchItems.push(t),t.checkbox&&t.checkbox.checked(!0))}),e.forEach(t=>{const s=new Event("searchItemAdded");Object.assign(s,t),document.dispatchEvent(s)})}removeItem(i){const e=i.searchid;i.checkbox&&i.checkbox.checked(!1);const t=this.searchItems.find(a=>a.searchid==e);this.searchItems=this.searchItems.filter(a=>a.searchid!=e);const s=new Event("searchItemRemoved");Object.assign(s,t),document.dispatchEvent(s)}getItemWithId(i){return this.searchItems.find(e=>e.searchid==i)}clearAll(){this.searchItems.forEach(e=>this.removeItem(e));const i=new Event("searchItemsCleared");document.dispatchEvent(i)}sendSearchParams(i){let e=new URLSearchParams(i),t="/catalogue";e.set("offset",0),e.set("limit",18);for(const[s,a]of Object.entries(i))if(Array.isArray(a)){e.set(`${s}[]`,a[0]);for(let n=1;n<a.length;n++)e.append(`${s}[]`,a[n])}e.size>0&&(t+="?"+e.toString(),window.open(t,"_self"))}submitSearch(){const i={},e={};this.searchItems.forEach(t=>{let s=t.field,a=!0;switch(t.condition){case">=":s=`${t.field}-from`,a=!1;break;case"<=":s=`${t.field}-to`,a=!1;break;case"<>":s=`${t.field}-not`,a=!1;break}t.secondaryField&&(a=!1,e[t.secondaryField]=t.secondaryValue),a?(i[s]||(i[s]=[]),i[s].push(encodeURIComponent(t.value)),e[s]=i[s]):e[s]=t.value}),this.sendSearchParams(e)}}class y{constructor(i,e=!1){r(this,"bubblesContainer",null);r(this,"clearAllButton",null);r(this,"searchController",null);r(this,"bubbles",[]);r(this,"searchOnRemove",!1);this.searchController=i,this.bubblesContainer=document.getElementsByClassName("filter-bubble base-container")[0],this.clearAllButton=this.bubblesContainer.children[0],this.clearAllButton.addEventListener("click",()=>this.clearAll()),this.searchOnRemove=e,document.addEventListener("searchItemAdded",t=>this.addBubble(t)),document.addEventListener("searchItemRemoved",t=>this.removeBubble(t.searchid))}addBubble(i){let e=null;if(!i.nobubble){e=document.createElement("div"),e.className="filter-bubble container";const t=document.createElement("span");t.textContent=i.displayName,e.appendChild(t);const s=document.createElement("div");s.className="icon action-close-2",e.appendChild(s),e.addEventListener("click",()=>{this.searchController.removeItemWithId(i.searchid),this.searchOnRemove&&this.searchController.submitSearch()}),e.searchid=i.searchid,this.bubblesContainer.appendChild(e),this.bubbles.push(e)}this.updateClearButton()}removeBubble(i){const e=this.bubbles.filter(t=>t.searchid==i)[0];e&&(e.remove(),this.bubbles=this.bubbles.filter(t=>t.searchid!=i)),this.updateClearButton()}updateClearButton(){this.bubbles.length==0?this.clearAllButton.style.display="none":this.clearAllButton.style.display="flex"}clearAll(){this.searchController.clearAll()}}class x extends b{constructor(e,t){super(e,t);r(this,"inputFrom");r(this,"inputTo");r(this,"fromScrolls");r(this,"toScrolls");r(this,"fromSearchId");r(this,"toSearchId");r(this,"prefixFrom","от");r(this,"prefixTo","до");r(this,"postfix","");const s=Array.from(this.button.getElementsByClassName("price-dropdown title"));this.inputFrom=s[0],this.inputTo=s[1],["input"].forEach(h=>{this.inputFrom.addEventListener(h,o=>this.onInputFromTyped(o)),this.inputTo.addEventListener(h,o=>this.onInputToTyped(o))}),document.addEventListener("searchItemAdded",h=>this.onSearchItemAdded(h)),document.addEventListener("searchItemRemoved",h=>this.onSearchItemRemoved(h));const n=this.container.getElementsByClassName("price-dropdown container");this.fromScrolls=n[0],this.toScrolls=n[1],this.fromSearchId=this.fromScrolls.firstElementChild.getAttribute("searchid"),this.toSearchId=this.toScrolls.firstElementChild.getAttribute("searchid"),this.addObjectTemplate=m(this.toScrolls.firstElementChild)}onSearchItemAdded(e){this.updateTitleFromEvent(e)}onSearchItemRemoved(e){this.updateTitleFromEvent(e),e.searchid==this.fromSearchId&&this.inputFrom.value==e.value&&(this.inputFrom.value=""),e.searchid==this.toSearchId&&this.inputTo.value==e.value&&(this.inputTo.value="")}updateTitleFromEvent(e){(e.searchid==this.fromSearchId||e.searchid==this.toSearchId)&&this.updateTitle()}onInputFromTyped(e){if(this.filterInput(this.inputFrom),!this.inputFrom.value){this.searchController.removeItemWithId(this.fromSearchId);return}const t={};Object.assign(t,this.addObjectTemplate),t.condition=">=",t.searchid=this.fromSearchId,this.onInputTyped(t,this.inputFrom)}onInputToTyped(e){if(this.filterInput(this.inputTo),!this.inputTo.value){this.searchController.removeItemWithId(this.toSearchId);return}const t={};Object.assign(t,this.addObjectTemplate),t.condition="<=",t.searchid=this.toSearchId,this.onInputTyped(t,this.inputTo)}onInputTyped(e,t){const s=this.searchController.getItemWithId(this.fromSearchId),a=this.searchController.getItemWithId(this.toSearchId);t==this.inputFrom&&a&&Number.parseInt(t.value)>Number.parseInt(a.value)&&(t.value=t.value.toString().substring(1)),e.filter=this,e.value=Number.parseInt(t.value),t==this.inputFrom&&(!a||Number.parseInt(e.value)<Number.parseInt(a.value))&&this.addMinValue(e),t==this.inputTo&&(!s||Number.parseInt(e.value)>Number.parseInt(s.value))&&this.addMaxValue(e)}filterInput(e){const s=e.value.toString().split("");let a=["0","1","2","3","4","5","6","7","8","9","."];const n=[];s.forEach((h,o)=>{a.includes(h)&&o<4&&n.push(h)}),e.value=n.join("")}onOptionClicked(e){const t=m(e);t.value=Number.parseFloat(t.value),t.filter=this;const s=this.searchController.getItemWithId(this.fromSearchId),a=this.searchController.getItemWithId(this.toSearchId);e.parentElement==this.fromScrolls&&(!a||t.value<a.value)&&this.addMinValue(t),e.parentElement==this.toScrolls&&(!s||t.value>s.value)&&this.addMaxValue(t)}addMinValue(e){this.searchController.removeItemWithId(e.searchid),e.displayName=`${this.prefixFrom} ${e.value} ${this.postfix}`,this.searchController.addItem(e)}addMaxValue(e){this.searchController.removeItemWithId(e.searchid),e.displayName=`${this.prefixTo} ${e.value} ${this.postfix}`,this.searchController.addItem(e)}updateTitle(){let e=this.defaultTitle,t=!1;const s=this.searchController.getItemWithId(this.fromSearchId),a=this.searchController.getItemWithId(this.toSearchId);s&&(e+=` от ${s.value} `,t=!0),a&&(e+=` до ${a.value} `,t=!0),t?(e+=this.postfix,this.title.textContent=e):this.title.textContent=this.defaultTitle}}class M extends x{constructor(e,t){super(e,t);r(this,"prefixFrom","от");r(this,"prefixTo","до");r(this,"postfix","млн ₽")}addMinValue(e){this.searchController.removeItemWithId(e.searchid),e.displayName=`${this.prefixFrom} ${this.formatPrice(e.value)} ${this.postfix}`,this.searchController.addItem(e)}addMaxValue(e){this.searchController.removeItemWithId(e.searchid),e.displayName=`${this.prefixTo} ${this.formatPrice(e.value)} ${this.postfix}`,this.searchController.addItem(e)}onInputTyped(e,t){e.filter=this,e.value=Number.parseFloat(t.value)*1e6;const s=this.searchController.getItemWithId(this.fromSearchId),a=this.searchController.getItemWithId(this.toSearchId);t==this.inputFrom&&(!a||e.value<a.value)&&this.addMinValue(e),t==this.inputTo&&(!s||e.value>s.value)&&this.addMaxValue(e)}formatPrice(e){return f(Number.parseFloat(e/1e6),-1)}updateTitle(){let e="",t=!1;const s=this.searchController.getItemWithId(this.fromSearchId),a=this.searchController.getItemWithId(this.toSearchId);if(s){const n=this.formatPrice(s.value);e+=`${this.prefixFrom} ${n} `,t=!0}if(a){const n=this.formatPrice(a.value);e+=`${this.prefixTo} ${n} `,t=!0}t?(e+=this.postfix,this.title.textContent=e):this.title.textContent=this.defaultTitle}}class w{constructor(i,e,t=!1,s=void 0){r(this,"lastSelectedData");r(this,"buttons",[]);r(this,"isUnique",!1);const a=document.getElementById(e);this.buttons=Array.from(a.getElementsByClassName("filter-toggles button")),this.isUnique=a.getAttribute("allowMultiple")!="1",this.buttons.forEach((n,h)=>{const o=n.className,c=m(n);document.addEventListener("searchItemAdded",d=>{d.searchid==c.searchid&&(n.className=o+" selected",this.isUnique&&this.lastSelectedData&&this.lastSelectedData!=d.searchid&&i.removeItemWithId(this.lastSelectedData),this.lastSelectedData=d.searchid)}),document.addEventListener("searchItemRemoved",d=>{d.searchid==c.searchid&&(n.className=o)}),s==null?n.addEventListener("click",()=>{i.addOrRemoveItemWithId(c),t&&i.submitSearch()}):n.addEventListener("click",()=>s(h))})}}export{w as B,x as F,M as P,C as S,y as a,V as b,g as c};
