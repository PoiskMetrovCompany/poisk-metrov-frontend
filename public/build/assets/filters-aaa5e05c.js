var u=Object.defineProperty;var g=(n,t,e)=>t in n?u(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(g(n,typeof t!="symbol"?t+"":t,e),e);import{S as m,a as p,P as f,B as o,b as E,c as l}from"./ButtonsGrid-3639f438.js";import{S as b}from"./SearchBar-837acfd5.js";import{C as h}from"./CustomDropdownFilter-b5d48bec.js";import{F as C,A as w,K as S}from"./KitchenFromToDropdownFilter-89fe7d8c.js";import{a as B}from"./axios-1779699b.js";import{P as y}from"./paginator-3d74c680.js";import{l as v,o as P,f as d}from"./loadCityMap-a5833feb.js";import{s as F}from"./sleep-9eff569f.js";import"./getDataFromOption-f8a05e9b.js";import"./wasClickedOutside-18ded071.js";import"./colors-10675ae3.js";import"./cookies-2118fce7.js";class M{constructor(){a(this,"searchController");a(this,"searchBar");a(this,"searchBubbles");a(this,"roomsFilter");a(this,"yearsFilter");a(this,"finishingFilter");a(this,"toiletFilter");a(this,"metroFilter");a(this,"registrationFilter");a(this,"mortgageFilter");a(this,"apartmentFilter");a(this,"yearsButtons");a(this,"roomsButtons");a(this,"metroButtons");a(this,"finishingButtons");a(this,"toiletButtons");a(this,"registrationButtons");a(this,"paymentButtons");a(this,"apartmentButtons");a(this,"pricesDropdown");a(this,"floorsDropdown");a(this,"areaDropdown");a(this,"kitchenAreaDropdown");a(this,"priceRange");a(this,"floorsRange");a(this,"areaRange");a(this,"kitchenAreaRange");a(this,"menuObject");a(this,"openMenuButton");a(this,"closeMenuButton");a(this,"searchButton");a(this,"offset",0);a(this,"limit",18);a(this,"isLoading",!1);a(this,"defaultMenuClass");a(this,"searchRangeSliders",[]);this.searchController=new m,this.searchBar=new b(this.searchController,"search-bar"),this.searchBubbles=new p(this.searchController,!0),this.limit=this.searchBar.searchBar.getAttribute("limit"),this.roomsFilter=new h(this.searchController,"filter-rooms-number","names-dropdown item"),this.yearsFilter=new h(this.searchController,"filter-years-number","names-dropdown item"),this.toiletFilter=new h(this.searchController,"filter-toilet","names-dropdown item"),this.finishingFilter=new h(this.searchController,"filter-finishing","names-dropdown item"),this.metroFilter=new h(this.searchController,"filter-metro-distance","names-dropdown item"),this.registrationFilter=new h(this.searchController,"filter-registration","names-dropdown item"),this.mortgageFilter=new h(this.searchController,"filter-mortgage","names-dropdown item"),this.apartmentFilter=new h(this.searchController,"filter-apartments","names-dropdown item"),this.pricesDropdown=new f(this.searchController,"filter-price"),this.floorsDropdown=new C(this.searchController,"filter-floors"),this.areaDropdown=new w(this.searchController,"filter-area"),this.kitchenAreaDropdown=new S(this.searchController,"filter-kitchen-area"),this.yearsButtons=new o(this.searchController,"years-buttons",!0),this.roomsButtons=new o(this.searchController,"rooms-buttons",!0),this.metroButtons=new o(this.searchController,"metro-buttons",!0),this.finishingButtons=new o(this.searchController,"finishing-buttons",!0),this.toiletButtons=new o(this.searchController,"toilet-buttons",!0),this.registrationButtons=new o(this.searchController,"registration-buttons",!0),this.paymentButtons=new o(this.searchController,"payment-methods-buttons",!0),this.apartmentButtons=new o(this.searchController,"apartments-buttons",!0),this.priceRange=new E("price-min-max-range",this.pricesDropdown),this.floorsRange=new l("floor-min-max-range",this.floorsDropdown),this.areaRange=new l("area-min-max-range",this.areaDropdown),this.kitchenAreaRange=new l("kitchen-area-min-max-range",this.kitchenAreaDropdown),this.searchRangeSliders=[this.priceRange,this.floorsRange,this.areaRange,this.kitchenAreaRange],this.loadMenu(),this.searchController.loadParametersFromSearchBar(),this.searchController.sendSearchParams=t=>this.sendSearchRequest(t),document.addEventListener("searchItemAdded",()=>this.searchController.submitSearch()),document.addEventListener("searchItemsCleared",()=>this.submitSearchWithClear())}loadMenu(){this.openMenuButton=document.getElementById("show-filters-menu-mobile"),this.closeMenuButton=document.getElementById("close-filter-menu-button"),this.menuObject=document.getElementsByClassName("search-catalogue base-container")[0],this.defaultMenuClass=this.menuObject.className,this.menuObject.addEventListener("submit",s=>this.onSubmit(s)),this.searchButton=this.menuObject.querySelector("input.common-button");const t=["show-filters-menu"],e=document.querySelector(".secondary");t.forEach(s=>document.getElementById(s).addEventListener("click",()=>{e.style.display!="grid"?e.style.display="grid":e.style.display="none"})),this.openMenuButton.addEventListener("click",()=>this.menuObject.className=this.defaultMenuClass+" shown"),this.closeMenuButton.addEventListener("click",()=>this.menuObject.className=this.defaultMenuClass)}onSubmit(t){t.preventDefault(),this.submitSearchWithClear(),this.menuObject.className=this.defaultMenuClass}submitSearchWithClear(){this.offset=0,this.searchController.submitSearch()}emitSearchStartEvent(){const t=new Event("searchStarted");document.dispatchEvent(t)}emitSearchEndEvent(t){const e=new Event("searchEnded");e.response=t,document.dispatchEvent(e)}async sendSearchRequest(t){if(this.isLoading)return;this.isLoading=!0;const e=this.searchBar.searchBar.getAttribute("cardelement");e&&(t.cardelement=e),t.limit=this.limit,t.offset=this.offset,this.searchButton.value="Ищем квартиры...",this.emitSearchStartEvent();const s=await B.get("/catalogue-items",{params:t});this.emitSearchEndEvent(s),s.data.fullfilledApartments>0?this.searchButton.value="Найдено "+s.data.fullfilledApartments+" квартир":this.searchButton.value="Нет квартир",this.limit=this.searchBar.searchBar.getAttribute("limit"),this.isLoading=!1}resetSliders(){this.searchRangeSliders.forEach(t=>t.resetSlider())}}class I{constructor(t,e){a(this,"buildingCardsGrid");a(this,"searchStartEvent");a(this,"searchEndEvent");a(this,"registeredCardElements",["building-card","agent-building-card","wide-building-card"]);this.buildingCardsGrid=document.getElementById("building-cards-grid"),this.searchStartEvent=t,this.searchEndEvent=e,document.addEventListener(this.searchStartEvent,()=>this.onSearchStart()),document.addEventListener(this.searchEndEvent,s=>this.onSearchEnd(s))}onSearchStart(){this.transparentCards()}async onSearchEnd(t){this.clearCards(),this.buildingCardsGrid.innerHTML+=t.response.data.catalogueItems.join("")}transparentCards(){const t=Array.from(this.buildingCardsGrid.querySelectorAll(this.registeredCardElements));for(let e=0;e<t.length;e++)t[e].style.opacity=.5,t[e].style.pointerEvents="none"}clearCards(){const t=Array.from(this.buildingCardsGrid.querySelectorAll(this.registeredCardElements));for(let e=0;e<t.length;e++)t[e].remove()}}class A{constructor(t,e){a(this,"searchStartEvent");a(this,"searchEndEvent");this.searchStartEvent=t,this.searchEndEvent=e,document.addEventListener(this.searchStartEvent,()=>this.onSearchStart()),document.addEventListener(this.searchEndEvent,s=>this.onSearchEnd(s))}onSearchStart(){const t=document.getElementById("nothing-found");t.style.display="none"}onSearchEnd(t){const e=document.getElementById("nothing-found");e.style.display=t.response.data.catalogueItems.length>0?"none":"block"}}class L{constructor(t,e){a(this,"searchStartEvent");a(this,"searchEndEvent");this.searchStartEvent=t,this.searchEndEvent=e,document.addEventListener(this.searchStartEvent,()=>this.onSearchStart()),document.addEventListener(this.searchEndEvent,s=>this.onSearchEnd(s))}onSearchStart(){const t=document.getElementById("found-count");t.textContent="Ищем..."}onSearchEnd(t){const e=document.getElementById("found-count");e.style.display=t.response.data.catalogueItems.length>0?"block":"none";const s=t.response.data.buildingCount,r=t.response.data.fullfilledCount;e.textContent=`Найдено ${r} ЖК из ${s}`}}class D{constructor(t,e,s){a(this,"searchStartEvent");a(this,"searchEndEvent");a(this,"basePath",window.location.href);a(this,"currentPage",1);a(this,"paginator");a(this,"cataloguefilters");a(this,"baseTitle");a(this,"baseDescription");this.searchStartEvent=t,this.searchEndEvent=e,this.cataloguefilters=s,document.addEventListener(this.searchStartEvent,()=>this.onSearchStart()),document.addEventListener(this.searchEndEvent,i=>this.onSearchEnd(i)),this.loadPaginator(),this.baseTitle=document.title,Array.from(document.getElementsByTagName("meta")).forEach(i=>{i.getAttribute("name")=="description"&&(this.baseDescription=i.getAttribute("content"))})}onSearchStart(){const t=document.getElementById("paginator-with-show-more");t&&(t.parentElement.style.opacity=.5,t.parentElement.style.pointerEvents="none")}deletePaginator(){const t=document.getElementById("paginator-with-show-more");t&&t.parentElement.remove(),this.paginator=null}loadPaginator(){this.paginator=new y,this.paginator.buttonsGridId="catalogue-paginator",this.paginator.pageClass="catalogue-page",this.paginator.pagesContainerId="building-cards-grid",this.paginator.currentPage=0,this.currentPage=1;const t=window.location.href;if(t.includes("page=")){const s=t.indexOf("page=")+5;this.paginator.currentPage=Number(t.substring(s))-1,this.currentPage=this.paginator.currentPage+1}else this.paginator.currentPage=this.currentPage-1;this.paginator.load(),this.paginator.buttons.forEach(s=>{s.className.includes("hidden")||(s.className=this.paginator.buttonClass)}),this.paginator.buttons[this.paginator.currentPage]&&(this.paginator.buttons[this.paginator.currentPage].className=this.paginator.buttonClass+" current"),this.paginator.textButtons[0].className=this.paginator.currentPage==0?this.paginator.textButtonClass+" disabled":this.paginator.textButtonClass,this.paginator.textButtons[1].className=this.paginator.currentPage==this.paginator.buttons.length-1?this.paginator.textButtonClass+" disabled":this.paginator.textButtonClass;const e=document.getElementById("show-all-paginator");e.className=this.currentPage==this.paginator.buttons.length?this.paginator.textButtonClass+" disabled":this.paginator.textButtonClass,this.currentPage<this.paginator.buttons.length&&e.addEventListener("click",()=>this.showAll()),this.paginator.setPage=s=>this.setPage(s)}showAll(){this.cataloguefilters.offset=0,this.cataloguefilters.limit=1e3,history.pushState({},"",this.basePath),this.cataloguefilters.searchController.submitSearch()}setPage(t){const e=this.paginator.buttons.length;if(t>=0&&t<e){if(this.paginator.buttons[this.paginator.currentPage].className=this.paginator.buttonClass,this.paginator.currentPage>this.paginator.offset&&this.paginator.currentPage<e-this.paginator.offset-1&&this.paginator.hideButtons&&(this.paginator.buttons[this.paginator.currentPage].className+=" hidden"),this.paginator.currentPage=t,!this.paginator.hideButtons){this.paginator.buttons[this.paginator.currentPage].className=this.buttonClass+" current",this.paginator.buttons.forEach((s,r)=>{const i=r==this.paginator.currentPage;this.paginator.pages[r].style.display=i?"grid":"none"});return}this.paginator.buttons.forEach((s,r)=>{r==this.paginator.currentPage?s.className=this.paginator.buttonClass+" current":r>this.paginator.offset&&r<e-this.paginator.offset-1&&(s.className=this.paginator.buttonClass+" hidden")}),this.paginator.ellipseStart&&(this.paginator.ellipseStart.className=this.paginator.buttonClass+(this.paginator.currentPage>this.paginator.offset+3?"":" hidden")),this.paginator.ellipseEnd&&(this.paginator.ellipseEnd.className=this.paginator.buttonClass+(this.paginator.currentPage<e-(this.paginator.offset+4)?"":" hidden"));for(let s=Math.max(this.paginator.offset+1,this.paginator.currentPage-2);s<this.paginator.currentPage+3&&s<e-(this.paginator.offset+1);s++)s!=this.paginator.currentPage&&(this.paginator.buttons[s].className=this.paginator.buttonClass);history.pushState({},"",this.basePath+"/page="+(t+1)),this.updateMetaPage(t),this.searchWithPagination(t)}}updateMetaPage(t){Array.from(document.getElementsByTagName("meta")).forEach(s=>{s.getAttribute("name")=="description"&&s.setAttribute("content",this.baseDescription+" Стр. "+(t+1))}),document.title=this.baseTitle+", стр. "+(t+1)}searchWithPagination(t){this.cataloguefilters.offset=t*this.cataloguefilters.limit,window.scrollTo({top:0,left:0,behavior:"instant"}),this.cataloguefilters.searchController.submitSearch()}onSearchEnd(t){this.deletePaginator();const e=document.getElementById("catalogue-container"),s=document.createElement("div");s.innerHTML+=t.response.data.paginator,e.appendChild(s);const r=document.getElementById("show-all-paginator");r.style.display=t.response.data.catalogueItems.length>0?"flex":"none",this.loadPaginator()}}class N{constructor(t,e){a(this,"searchStartEvent");a(this,"searchEndEvent");a(this,"catalogueMap");a(this,"map");a(this,"ymaps3");a(this,"mapContainer");a(this,"fillingInProgress",!1);this.searchStartEvent=t,this.searchEndEvent=e,document.addEventListener(this.searchStartEvent,()=>this.onSearchStart()),document.addEventListener(this.searchEndEvent,s=>this.onSearchEnd(s)),this.loadMap()}async loadMap(){const[t,e,s]=await v("catalogue-map"),r=["catalogue-map-button","catalogue-map-button-mobile","agent-catalogue-map-button"];s!=null&&(this.catalogueMap=t,this.map=e,this.ymaps3=s,this.mapContainer=t.parentElement,r.forEach(i=>{const c=document.getElementById(i);c&&(c.onclick=()=>P(t))}),this.fillingInProgress=!0,await d(catalogueBuildings,t,e,s),this.fillingInProgress=!1)}onSearchStart(){this.clearMapContent()}clearMapContent(){const t=Array.from(document.getElementsByClassName("full-screen-map building-card"));for(let s=0;s<t.length;s++)t[s].remove();const e=Array.from(document.getElementsByClassName("full-screen-map location-with-name"));for(let s=0;s<e.length;s++)e[s].remove()}async onSearchEnd(t){for(;this.fillingInProgress;)await F(20);this.fillingInProgress=!0,await d(t.response.data.catalogueBuildings,this.catalogueMap,this.map,this.ymaps3,!1),this.fillingInProgress=!1}}document.addEventListener("DOMContentLoaded",()=>{const n=new M,t="searchStarted",e="searchEnded";new I(t,e),new A(t,e),new L(t,e),new D(t,e,n),new N(t,e)});
